<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gérer les arrondis d'un tableau croisé • tabloid</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Gérer les arrondis d'un tableau croisé">
<meta property="og:description" content="tabloid">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tabloid</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Contenu du package</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/aa_presentation_package.html">Présentation du package</a>
    </li>
    <li>
      <a href="../articles/bb_creer_tableau_croise.html">Construire un tableau croisé</a>
    </li>
    <li>
      <a href="../articles/cc_calculer_profil_ligne_colonne.html">Calculer un profil ligne ou colonne</a>
    </li>
    <li>
      <a href="../articles/dd_arrondir_tableau.html">Gérer les arrondis d'un tableau croisé</a>
    </li>
    <li>
      <a href="../articles/ee_masquer_partie_contenu_tableau.html">Masquer une partie du contenu du tableau</a>
    </li>
    <li>
      <a href="../articles/ff_afficher_joli_tableau_html.html">Afficher un tableau mis en forme</a>
    </li>
    <li>
      <a href="../articles/gg_exporter_joli_tableau_xlsx.html">Exporter le tableau dans un classeur</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://gitlab.insee.fr/espace-charges-etudes/boite-outils/tableaux" class="external-link">
    <span class="fa fa-gitlab"></span>
     
    Code source
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="dd_arrondir_tableau_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Gérer les arrondis d’un tableau croisé</h1>
            
      
      
      <div class="hidden name"><code>dd_arrondir_tableau.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="description-rapide">Description rapide<a class="anchor" aria-label="anchor" href="#description-rapide"></a>
</h2>
<p><code><a href="../reference/tab_round.html">tab_round()</a></code> est une des fonctions de customisation du contenu d’un tableau proposée par le package <code>tabloid</code>.</p>
<p>Elle permet d’arrondir les données des cellules et éventuellement de gérer la cohérence des sommes à 100 % pour les pourcentages lignes et colonnes, en proposant différentes règles de décision.</p>
<p>Elle prend en entrée un objet tab et rendent un autre objet tab transformé. Elle doit prendre place après une instruction <code><a href="../reference/tab_build.html">tab_build()</a></code> (et éventuellement <code><a href="../reference/tab_pct.html">tab_pct()</a></code>), mais peut intervenir avant ou après la fonction <code><a href="../reference/tab_mask.html">tab_mask()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="utilisation-de-la-fonction">Utilisation de la fonction<a class="anchor" aria-label="anchor" href="#utilisation-de-la-fonction"></a>
</h2>
<div class="section level3">
<h3 id="arrondir-à-un-certain-nombre-de-décimales-ou-à-la-dizaine-centaine-etc-">Arrondir à un certain nombre de décimales ou à la dizaine, centaine, etc.<a class="anchor" aria-label="anchor" href="#arrondir-%C3%A0-un-certain-nombre-de-d%C3%A9cimales-ou-%C3%A0-la-dizaine-centaine-etc-"></a>
</h3>
<p>Le paramètre <code>n</code> de la fonction <code><a href="../reference/tab_round.html">tab_round()</a></code> permet de préciser le nombre de décimales pour l’arrondi. Par défaut, il est à 0.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prenoms_mixtes</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/tab_build.html">tab_build</a></span><span class="op">(</span>var_rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">prenom</span>, <span class="va">lib_reg</span><span class="op">)</span>, </span>
<span>            var_cols <span class="op">=</span> <span class="va">sexe</span>, </span>
<span>            var_stat <span class="op">=</span> <span class="va">nombre</span>, </span>
<span>            stat <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/tab_pct.html">tab_pct</a></span><span class="op">(</span>pct <span class="op">=</span> <span class="st">"row"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/tab_round.html">tab_round</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/tab_round.png"></p>
<p>Le paramètre <code>n</code> doit être un entier. Il est possible de renseigner des entiers négatifs, pour arrondir à la dizaine, à la centaine, etc. Par exemple, pour arrondir à la centaine, on renseignera <code>n = -2</code>.</p>
</div>
<div class="section level3">
<h3 id="garantir-la-cohérence-dune-somme-de-pourcentages-à-100">Garantir la cohérence d’une somme de pourcentages à 100 %<a class="anchor" aria-label="anchor" href="#garantir-la-coh%C3%A9rence-dune-somme-de-pourcentages-%C3%A0-100"></a>
</h3>
<div class="section level4">
<h4 id="pourquoi-faire-ça">Pourquoi faire ça ?<a class="anchor" aria-label="anchor" href="#pourquoi-faire-%C3%A7a"></a>
</h4>
<p>Cette fonctionnalité peut surprendre les plus orthodoxes. Elle est en fait assez spécifique à une règle éditoriale de l’Insee qui impose qu’une série arrondie à n décimales est sensée sommer à 100 % à n décimales. Ainsi, il n’est pas possible de diffuser le tableau ci-dessous, puisque la somme des pourcentages de la première ligne fait 99 et que celle de chacune des deux lignes suivantes fait 101.</p>
<p><img src="images/tab_round_ex_non_autorise.png"></p>
<p>L’option proposée consiste à sacrifier un chiffre pour rétablir la somme à 100 %. La plupart du temps, il s’agit de faire un +1 ou un -1 (dans le cas où n = 0) quelque part. Dans certains cas, 2 chiffres de la série doivent être modifiés, si la somme vaut 98 ou 102. Si plus de deux chiffres doivent être modifiés, l’option ne peut pas s’appliquer et un message en avertit l’utilisateur. Ce cas peut arriver si le nombre de modalités est trop grand avec beaucoup de petites valeurs : dans ce cas, il est conseillé à l’utilisateur de regrouper des modalités.</p>
<p>Afin de savoir quel(s) chiffre(s) modifier, deux règles de décision sont proposées à l’utilisateur. Dans tous les cas, la fonction revient aux valeurs non arrondies des chiffres. L’option s’appliquera à toutes les lignes (respectivement colonnes) de manière indépendante, si c’est un pourcentage ligne (resp. colonne).</p>
</div>
<div class="section level4">
<h4 id="option-1-lowest_lie">Option 1 : <code>lowest_lie</code><a class="anchor" aria-label="anchor" href="#option-1-lowest_lie"></a>
</h4>
<p>Comme son nom l’indique, option = “lowest_lie” va choisir le(s) chiffre(s) à modifier en minimisant le “mensonge” réalisé, au sens du poids de l’erreur introduite par rapport au chiffre initial lui-même. Par exemple, dans la deuxième ligne du tableau ci-dessus, si la série “50 - 21 - 30” est en réalité : “49.7 - 20.5 - 29.8”, il est moins inexact de modifier le 49.7 en 49 (le -0.7 ne représente que 1.4 % du chiffre initial) que le 20.5 en 20 (le -0.5 représenterait 2.4 % du chiffre initial), ou a fortiori le 29.8 en 29 (2.7 %). La série modifiée sera donc : “49 - 21 - 30”.</p>
<p>Attention, cette option conduit plus souvent à modifier le chiffre le plus grand de la série.</p>
</div>
<div class="section level4">
<h4 id="option-2-closest">Option 2 : <code>closest</code><a class="anchor" aria-label="anchor" href="#option-2-closest"></a>
</h4>
<p>Comme son nom l’indique, option = “closest” va choisir le(s) chiffre(s) à modifier comme étant les plus proches, au sens de la valeur absolue de l’erreur introduite. Dans le même exemple de la deuxième ligne du tableau ci-dessus, si la série “50 - 21 - 30” est en réalité : “49.7 - 20.5 - 29.8”, faire un -1 impliquerait introduire une erreur de 0.7 sur le premier chiffre, 0.5 sur le deuxième et 0.8 sur le troisième. La série modifiée sera donc : “50 - 20 - 30”.</p>
<p>Attention, cette option peut conduire à modifier fortement des très petites valeurs, et notamment des 1 en 0 (pour n = 0).</p>
</div>
<div class="section level4">
<h4 id="option-verbose">Option <code>verbose</code><a class="anchor" aria-label="anchor" href="#option-verbose"></a>
</h4>
<p>L’option verbose = TRUE permet d’en dire plus à l’utilisateur dans la console sur les règles de décision appliquées et les chiffres modifiés. Cela peut être utile pour garder un oeil sur le nombre de chiffres modifiés (trop de modifications peuvent suggérer à l’utilisateur de regrouper des modalités), mais aussi pour vérifier que les chiffres phare commentés dans une publication ne sont pas modifiés.</p>
</div>
<div class="section level4">
<h4 id="remarques-diverses">Remarques diverses<a class="anchor" aria-label="anchor" href="#remarques-diverses"></a>
</h4>
<ul>
<li><p>Sur le fond, cette pratique est discutable. Cette fonctionnalité est néanmoins proposée pour harmoniser les façons de faire et faciliter la possibilité de les exécuter de façon automatique sur un grand nombre de séries.</p></li>
<li><p>Attention, contrairement à une idée parfois répandue, ces cas ne se raréfient pas lorsque l’on augmente le nombre de décimales !</p></li>
<li><p>Cette fonctionnalité a le parti pris de ne pas modifier de plus de plus de 10^n une valeur (autrement dit, il ne sera jamais possible de modifier un 49.5, normalement arrondi 50, en 48 ou en 51). Si la règle de décision appliquée conduit à cela en théorie, le message d’erreur suivant s’affiche : “La règle de décision n’a trouvé aucun chiffre potentiellement modifiable.”, et la série ne respectera pas la somme à 100 %. Cela n’impacte pas les traitements des autres lignes ou colonnes du tableau.</p></li>
<li><p>Cette fonctionnalité ne gère pas les marges colonnes pour un pourcentage ligne, ou les marges lignes pour un pourcentage colonnes. Cette mise en cohérence reste à effectuer par l’utilisateur.</p></li>
<li><p>Les calculs liés à la fonction tab_round s’exécutent indépendamment de la fonction tab_mask. Aussi, il est possible que des chiffres fassent l’objet d’une modification par l’option guarante_100 = TRUE, mais soient finalement masqués.</p></li>
<li><p>Contrairement à l’arrondi dit “à la moitié paire” utilisé par défaut de R (“une fois au-dessus, une fois en-dessous”), on utilise ici l’arrondi classique où, par exemple, 0.5 est arrondi à 1.</p></li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="exemple">Exemple<a class="anchor" aria-label="anchor" href="#exemple"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prenoms_mixtes</span> <span class="op">|&gt;</span></span>
<span> <span class="fu"><a href="../reference/tab_build.html">tab_build</a></span><span class="op">(</span>var_rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lib_reg</span>, <span class="va">sexe</span><span class="op">)</span>,</span>
<span>           var_cols <span class="op">=</span> <span class="va">prenom</span>,</span>
<span>           var_stat <span class="op">=</span> <span class="va">nombre</span>,</span>
<span>           lab_total <span class="op">=</span> <span class="st">"Total"</span>,</span>
<span>           stat <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span> <span class="fu"><a href="../reference/tab_pct.html">tab_pct</a></span><span class="op">(</span>pct <span class="op">=</span> <span class="st">"row"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span> <span class="fu"><a href="../reference/tab_round.html">tab_round</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">0</span>,</span>
<span>           guarantee_100 <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>           option <span class="op">=</span> <span class="st">"lowest_lie"</span>,</span>
<span>           verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/tab_round2.png"></p>
</div>
</div>
<div class="section level2">
<h2 id="liens-vers-les-autres-vignettes">Liens vers les autres vignettes<a class="anchor" aria-label="anchor" href="#liens-vers-les-autres-vignettes"></a>
</h2>
<p>Les vignettes suivantes présentent plus en détail l’utilisation des différentes fonctions :</p>
<ul>
<li><a href="http://espace-charges-etudes.gitlab-pages.insee.fr/boite-outils/tableaux/articles/bb_creer_tableau_croise.html" class="external-link">tab_build() : construire un tableau croisé</a></li>
<li><a href="http://espace-charges-etudes.gitlab-pages.insee.fr/boite-outils/tableaux/articles/cc_calculer_profil_ligne_colonne.html" class="external-link">tab_pct() : calculer un profil ligne ou colonne</a></li>
<li><a href="http://espace-charges-etudes.gitlab-pages.insee.fr/boite-outils/tableaux/articles/ee_masquer_partie_contenu_tableau.html" class="external-link">tab_mask() : masquer une partie du contenu d’un tableau</a></li>
<li><a href="http://espace-charges-etudes.gitlab-pages.insee.fr/boite-outils/tableaux/articles/ff_afficher_joli_tableau_html.html" class="external-link">tab_render() : afficher un tableau mis en forme</a></li>
<li><a href="http://espace-charges-etudes.gitlab-pages.insee.fr/boite-outils/tableaux/articles/gg_exporter_joli_tableau_xlsx.html" class="external-link">tab_xlsx() : exporter un tableau dans un classeur xlsx</a></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Maëlle Fontaine, Laurette Cretin.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
