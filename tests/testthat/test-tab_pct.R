# testthat::test_that("tab_pct_row", {
#
#   library(dplyr)
#   mat <- readr::read_rds(system.file("data", "prenoms.rds", package = "tabloid")) |>
#     filter(annais == "2020" &
#              prenom %in% c("Matthéo", "Mateo", "Matéo", "Matteo", "Matheo", "Mathéo", "Mattheo", "Mattéo")) |>
#     mutate(lib_reg = as.factor(lib_reg))
#
#   testthat::expect_equal(
#
#     mat |>
#       tab_build(var_rows = lib_reg,
#                 var_cols = prenom,
#                 lab_total = "Ensemble",
#                 stat = "sum",
#                 var_stat = nombre) |>
#       tab_pct("row") |>
#       print(),
#     structure(list(lib_reg = c("Auvergne-Rhône-Alpes", "Bourgogne-Franche-Comté",
#                                "Bretagne", "Centre-Val de Loire", "Corse", "Grand Est", "Guadeloupe",
#                                "Guyane", "Hauts-de-France", "Ile-de-France", "La Réunion", "Martinique",
#                                "Normandie", "Nouvelle-Aquitaine", "Occitanie", "Pays de la Loire",
#                                "Provence-Alpes-Côte d'Azur", "Ensemble"),
#                    Mateo = c(4.1343669250646,
#                              0, 0, 0, 0, 1.52284263959391, 0, 0, 2.22222222222222, 9.77011494252874,
#                              0, 0, 3.09278350515464, 6.2200956937799, 4.24528301886792, 2.02702702702703,
#                              2.62172284644195, 4.20524691358025),
#                    `Matéo` = c(12.4031007751938,
#                                7.59493670886076, 15.6521739130435, 13.1147540983607, 0, 10.1522842639594,
#                                0, 0, 9.44444444444444, 15.5172413793103, 8, 17.6470588235294,
#                                7.21649484536082, 11.9617224880383, 29.2452830188679, 16.8918918918919,
#                                15.3558052434457, 14.0817901234568),
#                    Matheo = c(1.29198966408269,
#                               5.06329113924051, 0, 0, 0, 0, 0, 0, 0, 0.766283524904214, 0,
#                               0, 0, 1.43540669856459, 1.41509433962264, 0, 2.24719101123596,
#                               0.964506172839506),
#                    `Mathéo` = c(46.7700258397933, 54.4303797468354,
#                                 56.5217391304348, 59.0163934426229, 15.7894736842105, 52.7918781725888,
#                                 76.4705882352941, 66.6666666666667, 62.7777777777778, 34.8659003831418,
#                                 72, 64.7058823529412, 69.0721649484536, 55.0239234449761, 30.188679245283,
#                                 54.0540540540541, 27.3408239700375, 46.141975308642),
#                    Matteo = c(11.3695090439276,
#                               0, 5.21739130434783, 0, 68.4210526315789, 13.1979695431472, 0,
#                               33.3333333333333, 4.44444444444444, 18.3908045977011, 0, 0, 0,
#                               5.74162679425837, 7.54716981132075, 3.37837837837838, 22.0973782771536,
#                               11.1882716049383),
#                    `Mattéo` = c(24.031007751938, 32.9113924050633,
#                                 22.6086956521739, 27.8688524590164, 15.7894736842105, 22.3350253807107,
#                                 0, 0, 18.8888888888889, 19.9233716475096, 20, 17.6470588235294,
#                                 20.6185567010309, 19.6172248803828, 27.3584905660377, 23.6486486486486,
#                                 30.3370786516854, 22.9552469135802),
#                    `Matthéo` = c(0, 0, 0, 0,
#                                  0, 0, 23.5294117647059, 0, 2.22222222222222, 0.766283524904214,
#                                  0, 0, 0, 0, 0, 0, 0, 0.462962962962963),
#                    Ensemble = c(100, 100,
#                                 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100,
#                                 100, 100, 100)),
#               row.names = c(NA, -18L),
#               class = c("tbl_df",
#                         "tbl", "data.frame"))
#   )
# })
#
# testthat::test_that("tab_pct_col", {
#
#   library(dplyr)
#   marie <- readr::read_rds(system.file("data", "prenoms.rds", package = "tabloid")) |>
#     filter(annais %in% c("1900", "1920", "1940", "1960", "1980", "2000", "2020") &
#              prenom == "Marie")
#
#
#   testthat::expect_equal(
#
#     marie |>
#       tab_build(var_rows = lib_reg,
#                 var_cols = annais,
#                 var_stat = nombre,
#                 lab_total = "Total",
#                 stat = "sum") |>
#       tab_pct("col") |>
#       print(),
#     structure(list(lib_reg = c("Auvergne-Rhône-Alpes", "Provence-Alpes-Côte d'Azur",
#                                "Grand Est", "Occitanie", "Nouvelle-Aquitaine", "Centre-Val de Loire",
#                                "Corse", "Bourgogne-Franche-Comté", "Bretagne", "Normandie",
#                                "Pays de la Loire", "Hauts-de-France", "Ile-de-France", "Guadeloupe",
#                                "Martinique", "Guyane", "La Réunion", "Mayotte", "Total"),
#                    `1900` = c(14.5582087152275,
#                               4.11239749155813, 13.7401511497025, 8.40770220292652, 14.4134909149381,
#                               2.88631612799485, 1.51350699469368, 6.18668596237337, 11.7442514873774,
#                               2.7255185721177, 5.71434314198424, 6.1062871844348, 3.89130085222705,
#                               0.516562148255347, 0.689419520823284, 0.0824087473870397, 2.71144878597845,
#                               0, 100),
#                    `1920` = c(13.7133853386372, 4.34984760035129, 13.8037919099034,
#                               7.75171772485406, 12.5122694632433, 1.53691171152555, 1.5188303972723,
#                               4.55649119181691, 13.3595081882523, 3.41995143875601, 7.12920390556388,
#                               7.59673503125484, 3.70925246680787, 0.431368497184481, 0.715503435449708,
#                               0.0542439427597252, 3.84098775636721, 0, 100),
#                    `1940` = c(12.112463356134,
#                               3.08696810873234, 11.5839033490273, 6.56480412187972, 11.7482455361109,
#                               2.33188238429422, 1.48796304521631, 4.91249888957982, 12.8408989961802,
#                               3.11361819312428, 9.29643777205294, 7.04894732166652, 3.23354357288798,
#                               0.546326730034645, 1.21257883983299, 0.0710668917118237, 8.80785289153416,
#                               0, 100),
#                    `1960` = c(9.9640814154583, 3.02647332712518, 12.3919116668884,
#                               5.74697352667287, 7.65597977916722, 2.09525076493282, 1.95556738060396,
#                               1.98217373952375, 6.81122788346415, 0.6585073832646, 11.6402820274046,
#                               2.84022881468671, 4.74258347745111, 0.937874151922309, 1.66289743248636,
#                               0.0997738459491818, 25.7882133829985, 0, 100),
#                    `1980` = c(10.0135135135135,
#                               3.47297297297297, 7.83783783783784, 5.39189189189189, 7.41891891891892,
#                               2.64864864864865, 0.486486486486486, 3.17567567567568, 5.21621621621622,
#                               3.90540540540541, 5.06756756756757, 9.82432432432432, 10.8918918918919,
#                               0.351351351351351, 0.72972972972973, 0.135135135135135, 23.4324324324324,
#                               0, 100),
#                    `2000` = c(9.3266677081706, 6.8583033900953, 9.46727073894704,
#                               6.99890642087174, 7.81127948758007, 3.14013435400719, 0.484299328229964,
#                               3.62443368223715, 5.60849867208249, 5.63974379003281, 5.31167005155444,
#                               9.93594750820184, 18.3565067958132, 0.124980471801281, 0.234338384627402,
#                               0.249960943602562, 6.82705827214498, 0, 100),
#                    `2020` = c(10.7317073170732,
#                               11.869918699187, 8.45528455284553, 6.82926829268293, 5.04065040650407,
#                               2.76422764227642, 1.6260162601626, 1.78861788617886, 4.0650406504065,
#                               2.92682926829268, 3.57723577235772, 8.29268292682927, 22.1138211382114,
#                               0.650406504065041, 0, 1.13821138211382, 7.47967479674797, 0.650406504065041,
#                               100),
#                    Total = c(12.9466638182724, 4.02264473403119, 12.738731040376,
#                              7.41650644449192, 12.0280566830449, 2.33924375133518, 1.45766574093855,
#                              4.78815068005412, 11.179947304707, 2.95378480381685, 7.25129957986185,
#                              6.69871110161646, 4.93484298226875, 0.516983550523392, 0.863063447981201,
#                              0.0897244178594317, 7.77113152460301, 0.00284839421775974, 100
#                    )),
#               row.names = c(NA, -19L),
#               class = c("tbl_df", "tbl", "data.frame"))
#   )
# })
#
